{% extends 'base.html' %}

{% block title %}اطلاعات محصول{% endblock %}

{% block content %}

    <div style="max-width: 1000px; margin: 3rem auto; display: flex; gap: 2rem; flex-wrap: wrap; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 2rem;">
      
      <div style="flex: 1 1 300px;">
        {% if product.image.url %}
          <img src="{{ product.image.url }}" alt="{{ product.name }}" style="width: 100%; height: auto; border-radius: 10px; object-fit: contain;" />
        {% else %}
          <div style="width: 100%; height: 300px; background: #eee; display: flex; justify-content: center; align-items: center; border-radius: 10px;">
            No Image Available
          </div>
        {% endif %}
      </div>

      <div style="flex: 2 1 400px; display: flex; flex-direction: column; gap: 1rem;">
        <h2 style="font-size: 2rem; color: #28a745;">{{ product.name }}</h2>
        <p style="font-size: 1.2rem; color: #444;"><strong>Brand:</strong> {{ product.brand }}</p>
        <p style="font-size: 1.1rem;"><strong>Category:</strong> {{ product.get_category_display }}</p>
        <p style="font-size: 1.1rem;"><strong>Price:</strong> ${{ product.price }}</p>
        <p style="font-size: 1.1rem;"><strong>Rating:</strong> {{ product.rating }} ⭐</p>

        {% if product.skin_type.all %}
          <p><strong>Skin Type:</strong> 
            {% for sk in product.skin_type.all %}
              <span style="background:#eafaf1; padding: 3px 8px; margin: 2px; border-radius: 8px;">{{ sk.name }}</span>
            {% empty %}
              N/A
            {% endfor %}
          </p>
        {% endif %}

        {% if product.concerns_targeted.all %}
          <p><strong>Concerns:</strong> 
            {% for con in product.concerns_targeted.all %}
              <span style="background:#ffeef0; padding: 3px 8px; margin: 2px; border-radius: 8px;">{{ con.name }}</span>
            {% endfor %}
          </p>
        {% endif %}

        {% if product.ingredients.all %}
          <p><strong>Ingredients:</strong>
            {% for ing in product.ingredients.all %}
              <span style="background:#e0f0ff; padding: 3px 8px; margin: 2px; border-radius: 8px;">{{ ing.name }}</span>
            {% endfor %}
          </p>
        {% endif %}

        {% if product.tags.all %}
          <p><strong>Tags:</strong>
            {% for tag in product.tags.all %}
              <span style="background:#f5f5f5; padding: 3px 8px; margin: 2px; border-radius: 6px;">#{{ tag.name }}</span>
            {% endfor %}
          </p>
        {% endif %}
      <form method="POST" action="{% url 'add_wishlist' product.id %}">
        {% csrf_token %}
        <button type="submit" style="margin-top: 1rem; background: #bc2222; color: white; padding: 0.7rem 1.1rem; border: none; border-radius: 8px;"> <i class="fas fa-heart"></i> افزودن به علاقه مندی ها</button>
      </form>
          <div class="quantity-control">
            {% if product.quantity > 0 %}
              {% if ord_itm %}
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <form method="POST" action="{% url 'delete_from_cart' ord_itm.product_id.id %}">
                    {% csrf_token %}
                    <button type="submit" style="padding: 4px 10px; font-size: 1rem;">➖</button>
                  </form>

                  <div style="min-width: 40px; text-align: center; font-weight: bold;">
                    {{ ord_itm.quantity }}
                  </div>

                  <form method="POST" action="{% url 'add_to_cart' ord_itm.product_id.id %}">
                    {% csrf_token %}
                    <button type="submit" style="padding: 4px 10px; font-size: 1rem;">➕</button>
                  </form>
                </div>
          </div>
          <div class="costume_button">
              {% else %}
                <form method="POST" action="{% url 'add_to_cart' product.id %}">
                  {% csrf_token %}
                  <button type="submit" style="margin-top: 0rem;
                    background: #1dde61; 
                    color: rgb(255, 255, 255); 
                    padding: 0.6rem 2.2rem; 
                    border: none; 
                    border-radius: 6px;">
                      افزودن به سبد خرید</button>
                </form>
          
              {% endif %}
            {% else %}
              <button disabled style="margin-top: 1rem; background: rgb(67, 219, 125); color: white; padding: 0.5rem 1rem; border: none; border-radius: 8px; cursor: not-allowed;">ناموجود</button>
            {% endif %}
          </div>
      </div>
      
    </div>

    <div style="margin-top: 3rem; text-align: center;">
      <h3 style="margin-bottom: 1rem;">Your Rating:</h3>
      
      <form method="POST" action="{% url 'rate_product' product.id %}" id="rating-form">
        {% csrf_token %}
        <div id="star-container" style="font-size: 2rem; color: #ccc; cursor: pointer;">
          {% for i in "12345" %}
            <span class="star" data-value="{{ forloop.counter }}">&#9733;</span>
          {% endfor %}
        </div>
        <input type="hidden" name="rating" id="rating-value" value="{{ user_rating }}">
        <button type="submit" style="margin-top: 1rem; background: #79ff96; color: rgb(255, 255, 255); padding: 0.5rem 1rem; border: none; border-radius: 8px;">Submit Rating</button>
      </form>
    </div>

    <style>
      .quantity-control {
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #ccc;
        border-radius: 8px;
        overflow: hidden;
        width: fit-content;
      }
      .quantity-control form button {
        background: #ffffff;
        color: white;
        border: none;
        padding: 6px 12px;
        cursor: pointer;
        font-weight: bold;
      }
      .quantity-control div {
        padding: 3px 10px;
        font-weight: bold;
        font-size: 1.1rem;
      }

    </style>

    <script>
      const stars = document.querySelectorAll('.star');
      const ratingInput = document.getElementById('rating-value');
      const currentRating = parseInt(ratingInput.value);
      
      if (currentRating) {
        stars.forEach(star => {
          if (parseInt(star.dataset.value) <= currentRating) {
            star.style.color = '#ffc107';
          }
        });
      }

      stars.forEach(star => {
        star.addEventListener('mouseover', () => {
          resetStars();
          highlightStars(star.dataset.value);
        });

        star.addEventListener('mouseout', () => {
          resetStars();
          highlightStars(ratingInput.value);
        });

        star.addEventListener('click', () => {
          ratingInput.value = star.dataset.value;
          highlightStars(ratingInput.value);
        });
      });

      function highlightStars(value) {
        stars.forEach(star => {
          if (parseInt(star.dataset.value) <= value) {
            star.style.color = '#ffc107';
          }
        });
      }

      function resetStars() {
        stars.forEach(star => {
          star.style.color = '#ccc';
        });
      }
    </script>

    
{% endblock %}